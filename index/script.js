(()=>{"use strict";class t{constructor(e,s={}){s.context=this,this.$root=t.make(e,s)}static make(e,s={}){return e&&"object"==typeof s?s instanceof Node?s:t.config(document.createElement(e),s):null}static makeShadow(e,s={},i=null){if(!e||"object"!=typeof s)return null;let r=e instanceof Node?e:document.createElement(e);return r.attachShadow({mode:"open"}),t.config(r.shadowRoot,{context:s.context,children:[{tag:"style",textContent:i??""},s.child??{},...s.children??[]]}),delete s.children,delete s.child,t.config(r,s),r}static config(e,s){if(!(e instanceof Node)||"object"!=typeof s)return e;const i=s.context;let r=s=>{if(s)if(s instanceof Node)e.appendChild(s);else if(s instanceof t)e.appendChild(s.$root);else if("object"==typeof s){s.context||(s.context=i);let r=t.make(s.tag,s);r&&e.appendChild(r)}else"string"==typeof s&&(e.innerHTML+=s)};for(const[t,c]of Object.entries(s))if(c)switch(t){case"tag":case"context":continue;case"text":e.textContent=c;break;case"html":e.innerHTML=c;break;case"class":e.classList.add(...c.split(" "));break;case"also":i&&c.call(i,e);break;case"export":c[0]=e;break;case"var":i&&(i["$"+c]=e);break;case"events":for(let t in c)c[t]&&e.addEventListener(t,c[t].bind(i));break;case"parent":(c instanceof Node||c instanceof DocumentFragment)&&c.append(e);break;case"attrs":for(let t in c)e.setAttribute(t,c[t]);break;case"props":for(let t in c)e[t]=c[t];break;case"child":r(c);break;case"children":for(const t of c)r(t);break;case"style":if("string"==typeof c)e.style.cssText+=c+";";else for(let t in c)e.style[t]=c[t];break;default:e[t]=c}return e}static makeArray(e){return e&&Array.isArray(e)?e.map((e=>t.make(e.tag,e))):[]}}new Set,new Map;class e{matrix=new Int32Array;W=0;H=0;constructor(t,e){this.resize(t,e)}resize(t,e){t&&e&&(this.W=t,this.H=e,this.matrix=new Int32Array(t*e).fill(0))}merge(t){if(this.matrix.length==t.matrix.length)for(let e=0;e<this.matrix.length;e++){let s=t.matrix[e];this.matrix[e]=s}}set(t,e,s){this.matrix[e*this.W+t]=s}get(t,e){return this.matrix[e*this.W+t]}clear(){this.matrix.fill(0)}}class s extends e{constructor(t,e,s){super(),t&&(this.cv=t,this.cx=t.getContext("2d"),this._onclick=e,this._ondrag=s,t.addEventListener("mousedown",(t=>this._onMouseDown(t))),document.addEventListener("mousemove",(t=>this._onMouseMove(t))),document.addEventListener("mouseup",(t=>this._onMouseUp(t))))}resize(t,e){super.resize(t,e),this._resize()}render(){this.cx.fillRect(0,0,this.cv.width,this.cv.height);let t=this._blocksize;for(let e=0;e<this.W;e++)for(let s=0;s<this.H;s++){switch(this.get(e,s)){case 0:this.cx.fillStyle=this.black;break;case 1:this.cx.fillStyle=this.gray;break;case 2:this.cx.fillStyle=this.white}this.cx.fillRect(e*t,s*t,t,t),this.cx.strokeRect(e*t,s*t,t,t)}}_resize(){if(!this.cv)return;let t=this.cv.parentNode.clientWidth;t=Math.floor(t/this.W)*this.W,t||(t=this.W);let e=t*this.H/this.W;this._blocksize=t/this.W,this.cv.width=t,this.cv.height=e,this.cx.lineWidth=this._blocksize/64,t=this.cv.parentNode.clientWidth,e=t*this.H/this.W,e>this._maxwidth&&(e=this._maxwidth,t=e*this.W/this.H),this._realW=t,this._realH=e,this.cv.style.width=t+"px",this.cv.style.height=e+"px",this.render()}_blocksize=0;_pressed=!1;_dragged=!1;_pressXY=[];black="#000000";white="#ffffff";gray="#808080";_realW=0;_realH=0;_maxwidth=800;_onMouseDown(t){this._pressed=!0,this._dragged=!1,this._pressXY=this._getXY(t)}_onMouseUp(t){if(!this._pressed)return;this._pressed=!1;let e=this._getXY(t),s=this._blockXY(e);this.get(s.x,s.y);this._dragged?(this.cv.style.cursor="pointer",document.body.style.cursor="default",this._ondrag(this._drag(e,!1))):this._onclick(s)}_onMouseMove(t){if(!this._pressed)return;this._dragged||(this.cv.style.cursor="grab",document.body.style.cursor="grab"),this._dragged=!0;let e=this._getXY(t),s=this._blockXY(e);this.get(s.x,s.y);this._ondrag(this._drag(e,!1))}_getXY(t){let e=t.pageX,s=t.pageY;return"BODY"==this.cv.offsetParent.tagName.toUpperCase()?(e-=this.cv.offsetLeft,s-=this.cv.offsetTop):(e-=this.cv.offsetParent.offsetLeft,s-=this.cv.offsetParent.offsetTop),e*=this.cv.width/this._realW,s*=this.cv.height/this._realH,{x:e,y:s}}_blockXY(t){return{x:Math.floor(t.x/this.cv.width*this.W),y:Math.floor(t.y/this.cv.height*this.H)}}_drag(t,e){return{dx:t.x-this._pressXY.x,dy:t.y-this._pressXY.y,block:this._blockXY(t),release:e}}}const i={0:32,1:176,2:219};function r(t){let e="Symbol ";return e+=function(t,e=16){let s="";for(let r=0;r<t.length;r+=e){let c=t.slice(r,r+e),n="db ",a=c[0],o=1;for(let t=1;t<c.length;t++)c[t]===a?o++:(n+=`${o} dup(${i[a]}), `,a=c[t],o=1);n+=`${o} dup(${i[a]}), `,s+=n+"10, 13\n"}return s}(t.matrix,16),e+="\n",{code:e}}let c=new s,n=new e,a=2,o=document.querySelector(".white");function h(){l()}function l(){c.merge(n),c.render(),function(){let t=r(c);document.getElementById("result_textarea").value=t.code}()}function d(t){n.set(t.x,t.y,a),h()}function f(t){n.set(t.block.x,t.block.y,a),h()}o.classList.add("active"),window.changeColor=function(t,e){switch(t){case"black":a=0;break;case"gray":a=1;break;case"white":a=2}o&&o.classList.remove("active"),o=e,o.classList.add("active")},document.addEventListener("DOMContentLoaded",(()=>{let e={};t.make("div",{class:"cv_cont",context:e,parent:document.getElementById("cv_root"),children:[{tag:"div",class:"cv_inner",children:[{tag:"canvas",class:"canvas",var:"cv"}]}]}),c=new s(e.$cv,d,f),function(){let t=[16,16];c.resize(t[0],t[1]),n.resize(t[0],t[1]),l()}()}))})();